<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>オンゲキ Utility</title>
  <!-- HTML -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://rawgit.com/abodelot/jquery.json-viewer/master/json-viewer/jquery.json-viewer.js"></script>
  <link href="https://rawgit.com/abodelot/jquery.json-viewer/master/json-viewer/jquery.json-viewer.css" rel="stylesheet" />
  <!-- Custom Styles -->
  <style>
    #fileMgr .upload-box {
      width: 94%;
      height: 300px;
      /*border: 1px solid gray;*/
      border-style: dashed;
      box-shadow: 2px 3px 9px hsl(0, 0%, 47%);
      padding: 10px;
    }
  </style>
</head>

<body>
  <script type="text/javascript" charset="utf-8">
    const userLang = navigator.language;
    var isKor = userLang == "ko-KR";
    const SitePatch = {
      kor: [
        "카드 파일을 업로드 해주세요.",
        "드래그 드롭가능",
        "카드 파일 뷰어"
      ],
      eng: [
        "plz...upload card file",
        "(you can drop-down file here)",
        "card file viewer"
      ]
    }
    isKor = false;

    function addFileZone() {
      let Patch = !isKor ? SitePatch.eng : SitePatch.kor;
      let w = document.createElement('selection');
      w.id = 'fileMgr';
      let h = document.createElement('h1');
      h.appendChild(document.createTextNode(Patch[0]));
      let fw = document.createElement('div');
      fw.className = 'upload-box';
      let f = document.createElement('input');
      f.id = 'fileInput';
      f.type = 'file';
      f.accept = 'application/JSON';
      f.required = true;
      fw.appendChild(f);
      let t = document.createElement('div');
      t.innerText = Patch[1];
      w.append(h, fw);
      document.body.appendChild(w)
    }
    addFileZone();
    //file
    var upload = document.getElementById('fileInput');

    function onFileChange() {
      const reader = new FileReader(); // File reader to read the file
      const parent = upload.parentElement;
      const isCard =(n)=>n.includes("card");
      let tree = document.createElement('div');
      let res = null;
      // Make sure a file was selected
      if (upload.files.length > 0) {
        reader.readAsText(upload.files[0]); // Read the uploaded file
        // This event listener will happen when the reader has read the file
        reader.addEventListener('load', function() {
          if(isCard(upload.files[0].name)){
          res = JSON.parse(reader.result); // Parse the result into an object
          upload.remove();
          parent.style.overflow = 'auto';
          tree.id = 'jsonTree';
          parent.appendChild(tree);
          $(function() {
            $('#jsonTree').jsonViewer(res);
          });
          
          console.log(res);
          }else{
            console.log("card check:",isCard(upload.files[0].name));
            upload.value = null;
          }
        });
      }
    }
    if (upload) {
      upload.addEventListener('change', onFileChange);
    }
  </script>
</body>

</html>